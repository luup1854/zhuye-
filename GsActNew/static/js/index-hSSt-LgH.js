import{E as z,G as xe,H as $,I as Z,d as K,J as L,K as q,L as j,r as f,M as be,l as _,N as ce,P as ue,Q as we,R as re,x as w,S as de,T as te,U as R,V as ve,W as ye,X as Te,Y as Oe,w as G,Z as J,_ as ke,$ as ne,a0 as Ce,B as ae,a1 as _e,a2 as Ee,p as Se,c as Pe,e as g,a as Q,a3 as W,t as Ie,j as De,F as Me,h as A,z as H,O as He,o as $e,g as Fe,a4 as Ne}from"./index-998c2ozu.js";const[Be,E,le]=z("picker"),me=t=>t.find(o=>!o.disabled)||t[0];function Ve(t,o){const n=t[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function U(t,o){o=Z(o,0,t.length);for(let n=o;n<t.length;n++)if(!t[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!t[n].disabled)return n;return 0}const oe=(t,o,n)=>o!==void 0&&!!t.find(r=>r[n.value]===o);function ee(t,o,n){const r=t.findIndex(h=>h[n.value]===o),c=U(t,r);return t[c]}function qe(t,o,n){const r=[];let c={[o.children]:t},h=0;for(;c&&c[o.children];){const x=c[o.children],p=n.value[h];if(c=xe(p)?ee(x,p,o):void 0,!c&&x.length){const d=me(x)[o.value];c=ee(x,d,o)}h++,r.push(x)}return r}function Ae(t){const{transform:o}=window.getComputedStyle(t),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function Re(t){return $({text:"text",value:"value",children:"children"},t)}const se=200,ie=300,Ue=15,[fe,X]=z("picker-column"),pe=Symbol(fe);var je=K({name:fe,props:{value:L,fields:q(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(L),visibleOptionNum:q(L)},emits:["change","clickOption","scrollInto"],setup(t,{emit:o,slots:n}){let r,c,h,x,p;const d=f(),b=f(),m=f(0),v=f(0),T=be(),C=()=>t.options.length,D=()=>t.optionHeight*(+t.visibleOptionNum-1)/2,k=a=>{let e=U(t.options,a);const l=-e*t.optionHeight,i=()=>{e>C()-1&&(e=U(t.options,a));const P=t.options[e][t.fields.value];P!==t.value&&o("change",P)};r&&l!==m.value?p=i:i(),m.value=l},O=()=>t.readonly||!t.options.length,F=a=>{r||O()||(p=null,v.value=se,k(a),o("clickOption",t.options[a]))},S=a=>Z(Math.round(-a/t.optionHeight),0,C()-1),M=_(()=>S(m.value)),N=(a,e)=>{const l=Math.abs(a/e);a=m.value+l/.003*(a<0?-1:1);const i=S(a);v.value=+t.swipeDuration,k(i)},I=()=>{r=!1,v.value=0,p&&(p(),p=null)},B=a=>{if(!O()){if(T.start(a),r){const e=Ae(b.value);m.value=Math.min(0,e-D())}v.value=0,c=m.value,h=Date.now(),x=c,p=null}},y=a=>{if(O())return;T.move(a),T.isVertical()&&(r=!0,de(a,!0));const e=Z(c+T.deltaY.value,-(C()*t.optionHeight),t.optionHeight),l=S(e);l!==M.value&&o("scrollInto",t.options[l]),m.value=e;const i=Date.now();i-h>ie&&(h=i,x=e)},s=()=>{if(O())return;const a=m.value-x,e=Date.now()-h;if(e<ie&&Math.abs(a)>Ue){N(a,e);return}const i=S(m.value);v.value=se,k(i),setTimeout(()=>{r=!1},0)},u=()=>{const a={height:`${t.optionHeight}px`};return t.options.map((e,l)=>{const i=e[t.fields.text],{disabled:P}=e,V=e[t.fields.value],ge={role:"button",style:a,tabindex:P?-1:0,class:[X("item",{disabled:P,selected:V===t.value}),e.className],onClick:()=>F(l)},he={class:"van-ellipsis",[t.allowHtml?"innerHTML":"textContent"]:i};return w("li",ge,[n.option?n.option(e,l):w("div",he,null)])})};return ce(pe),ue({stopMomentum:I}),we(()=>{const a=r?Math.floor(-m.value/t.optionHeight):t.options.findIndex(i=>i[t.fields.value]===t.value),e=U(t.options,a),l=-e*t.optionHeight;r&&e<a&&I(),m.value=l}),re("touchmove",y,{target:d}),()=>w("div",{ref:d,class:X(),onTouchstartPassive:B,onTouchend:s,onTouchcancel:s},[w("ul",{ref:b,style:{transform:`translate3d(0, ${m.value+D()}px, 0)`,transitionDuration:`${v.value}ms`,transitionProperty:v.value?"all":"none"},class:X("wrapper"),onTransitionend:I},[u()])])}});const[ze]=z("picker-toolbar"),Y={title:String,cancelButtonText:String,confirmButtonText:String},Ke=["cancel","confirm","title","toolbar"],Ye=Object.keys(Y);var Le=K({name:ze,props:Y,emits:["confirm","cancel"],setup(t,{emit:o,slots:n}){const r=()=>{if(n.title)return n.title();if(t.title)return w("div",{class:[E("title"),"van-ellipsis"]},[t.title])},c=()=>o("cancel"),h=()=>o("confirm"),x=()=>{var d;const b=(d=t.cancelButtonText)!=null?d:le("cancel");if(!(!n.cancel&&!b))return w("button",{type:"button",class:[E("cancel"),te],onClick:c},[n.cancel?n.cancel():b])},p=()=>{var d;const b=(d=t.confirmButtonText)!=null?d:le("confirm");if(!(!n.confirm&&!b))return w("button",{type:"button",class:[E("confirm"),te],onClick:h},[n.confirm?n.confirm():b])};return()=>w("div",{class:E("toolbar")},[n.toolbar?n.toolbar():[x(),r(),p()]])}});const[Ge,ut]=z("picker-group"),Je=Symbol(Ge);$({tabs:j(),activeTab:R(0),nextStepText:String,showToolbar:ve},Y);const Qe=$({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:R(44),showToolbar:ve,swipeDuration:R(1e3),visibleOptionNum:R(6)},Y),We=$({},Qe,{columns:j(),modelValue:j(),toolbarPosition:ye("top"),columnsFieldNames:Object});var Xe=K({name:Be,props:We,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(t,{emit:o,slots:n}){const r=f(),c=f(t.modelValue.slice(0)),{parent:h}=ce(Je),{children:x,linkChildren:p}=Te(pe);p();const d=_(()=>Re(t.columnsFieldNames)),b=_(()=>Oe(t.optionHeight)),m=_(()=>Ve(t.columns,d.value)),v=_(()=>{const{columns:e}=t;switch(m.value){case"multiple":return e;case"cascade":return qe(e,d.value,c);default:return[e]}}),T=_(()=>v.value.some(e=>e.length)),C=_(()=>v.value.map((e,l)=>ee(e,c.value[l],d.value))),D=_(()=>v.value.map((e,l)=>e.findIndex(i=>i[d.value.value]===c.value[l]))),k=(e,l)=>{if(c.value[e]!==l){const i=c.value.slice(0);i[e]=l,c.value=i}},O=()=>({selectedValues:c.value.slice(0),selectedOptions:C.value,selectedIndexes:D.value}),F=(e,l)=>{k(l,e),m.value==="cascade"&&c.value.forEach((i,P)=>{const V=v.value[P];oe(V,i,d.value)||k(P,V.length?V[0][d.value.value]:void 0)}),ae(()=>{o("change",$({columnIndex:l},O()))})},S=(e,l)=>{const i={columnIndex:l,currentOption:e};o("clickOption",$(O(),i)),o("scrollInto",i)},M=()=>{x.forEach(l=>l.stopMomentum());const e=O();return ae(()=>{o("confirm",e)}),e},N=()=>o("cancel",O()),I=()=>v.value.map((e,l)=>w(je,{value:c.value[l],fields:d.value,options:e,readonly:t.readonly,allowHtml:t.allowHtml,optionHeight:b.value,swipeDuration:t.swipeDuration,visibleOptionNum:t.visibleOptionNum,onChange:i=>F(i,l),onClickOption:i=>S(i,l),onScrollInto:i=>{o("scrollInto",{currentOption:i,columnIndex:l})}},{option:n.option})),B=e=>{if(T.value){const l={height:`${b.value}px`},i={backgroundSize:`100% ${(e-b.value)/2}px`};return[w("div",{class:E("mask"),style:i},null),w("div",{class:[_e,E("frame")],style:l},null)]}},y=()=>{const e=b.value*+t.visibleOptionNum,l={height:`${e}px`};return w("div",{ref:r,class:E("columns"),style:l},[I(),B(e)])},s=()=>{if(t.showToolbar&&!h)return w(Le,Ce(ne(t,Ye),{onConfirm:M,onCancel:N}),ne(n,Ke))};G(v,e=>{e.forEach((l,i)=>{l.length&&!oe(l,c.value[i],d.value)&&k(i,me(l)[d.value.value])})},{immediate:!0});let u;return G(()=>t.modelValue,e=>{!J(e,c.value)&&!J(e,u)&&(c.value=e.slice(0),u=e.slice(0))},{deep:!0}),G(c,e=>{J(e,t.modelValue)||(u=e.slice(0),o("update:modelValue",u))},{immediate:!0}),re("touchmove",de,{target:r}),ue({confirm:M,getSelectedOptions:()=>C.value}),()=>{var e,l;return w("div",{class:E()},[t.toolbarPosition==="top"?s():null,t.loading?w(ke,{class:E("loading")},null):null,(e=n["columns-top"])==null?void 0:e.call(n),y(),(l=n["columns-bottom"])==null?void 0:l.call(n),t.toolbarPosition==="bottom"?s():null])}}});const Ze=Ee(Xe),et={class:"relative min-h-full overflow-hidden base-bg bg-[url('https://gszy-oss.baijqr.cn/gansu_oss/gansu/mini_mall22/v2/lz-bgc1.png')]"},tt={class:"flex flex-col items-center"},nt={class:"flex items-center w-[320px] h-[42px] rounded-3xl bg-white mt-[30px]"},at={class:"flex items-center w-[320px] h-[42px] rounded-3xl bg-white mt-[30px]"},lt={class:"flex items-center w-[320px] h-[42px] rounded-3xl bg-white mt-[30px]"},ot={class:"flex items-center w-[320px] h-[42px] rounded-3xl bg-white mt-[30px]"},st={class:"absolute bottom-0 w-full"},it=K({__name:"index",setup(t){const o=f(!1),n=f([[],[],[]]),r=f(),c=f(),h=f(),x=f("必填，请选择 省/市/县"),p=f(),d=f(),b=f(),m=f(),v=f(),T=f(),C=f(),D=async()=>{var u;const s=(await A.request({url:"/cloud2.member.api/address/queryRegion?id=1&regionType=1",method:"get"})).map(a=>({value:a.region_id,text:a.region_name}));n.value[0]=s,r.value=(u=s[0])==null?void 0:u.value,await k(r.value)},k=async y=>{var a;const u=(await A.request({url:`/cloud2.member.api/address/queryRegion?id=${y}&regionType=2`,method:"get"})).map(e=>({value:e.region_id,text:e.region_name}));return n.value[1]=u,c.value=(a=u[0])==null?void 0:a.value,await O(c.value),u},O=async y=>{var a;const u=(await A.request({url:`/cloud2.member.api/address/queryRegion?id=${y}&regionType=3`,method:"get"})).map(e=>({value:e.region_id,text:e.region_name}));return n.value[2]=u,h.value=(a=u[0])==null?void 0:a.value,u},F=async y=>{var a,e,l;const{selectedOptions:s,columnIndex:u}=y;if(u===0){r.value=(a=s[0])==null?void 0:a.value;const i=await k(r.value);n.value[1]=i}if(u===1){c.value=(e=s[1])==null?void 0:e.value;const i=await O(c.value);n.value[2]=i}u===2&&(h.value=(l=s[2])==null?void 0:l.value)},S=()=>{var y,s,u;d.value=(y=n.value[0].find(a=>a.value===r.value))==null?void 0:y.text,b.value=(s=n.value[1].find(a=>a.value===c.value))==null?void 0:s.text,m.value=(u=n.value[2].find(a=>a.value===h.value))==null?void 0:u.text,x.value=`${d.value} / ${b.value} / ${m.value}`,o.value=!1},M=()=>p.value?v.value?T.value?T.value.length<11?(H("联系电话格式有误"),!1):!x.value||!v.value?(H("地址不能为空"),!1):!0:(H("联系电话不能为空"),!1):(H("地址不能为空"),!1):(H("收货人姓名不能为空"),!1),N=_(()=>({aid:C.value,contacts:p.value,address:v.value,phone:T.value,province:d.value,city:b.value,area:m.value})),I=()=>A.request({url:"/cloud2.activity.api/marketAct/address/save",method:"post",params:{userToken:Fe()},data:N.value}),B=async()=>{M()&&(await I(),H("保存成功"))};return Se(()=>{const y=()=>{const u=window.location.hash.split("?")[1];return u?new URLSearchParams(u).get("aid"):null};C.value=y(),D()}),(y,s)=>{const u=Ze,a=He;return $e(),Pe(Me,null,[g("div",et,[g("div",tt,[s[10]||(s[10]=g("div",{class:"mt-[45px] font-bold text-[19px] text-[#6F6156]"},"收货地址",-1)),g("div",nt,[s[6]||(s[6]=g("img",{src:"https://gszy-oss.baijqr.cn/gansu_oss/gansu/common/user_icon.png",class:"w-[30px] h-[30px] ml-4"},null,-1)),Q(g("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),type:"text",placeholder:"必填，请输入收货人姓名",class:"flex-1 bg-transparent outline-none ml-2 text-[#908E8F] placeholder-[#908E8F]"},null,512),[[W,p.value]])]),g("div",at,[s[7]||(s[7]=g("img",{src:"https://gszy-oss.baijqr.cn/gansu_oss/gansu/common/address-icon.png",class:"w-[30px] h-[30px] ml-4"},null,-1)),g("div",{class:"btn flex-1 ml-2 text-[#908E8F]",onClick:s[1]||(s[1]=e=>o.value=!0)},Ie(x.value),1)]),g("div",lt,[s[8]||(s[8]=g("img",{src:"https://gszy-oss.baijqr.cn/gansu_oss/gansu/common/address-icon.png",class:"w-[30px] h-[30px] ml-4"},null,-1)),Q(g("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>v.value=e),type:"text",placeholder:"必填，请输入详细地址",class:"flex-1 bg-transparent outline-none ml-2 text-[#908E8F] placeholder-[#908E8F]"},null,512),[[W,v.value]])]),g("div",ot,[s[9]||(s[9]=g("img",{src:"https://gszy-oss.baijqr.cn/gansu_oss/gansu/common/phone_icon.png",class:"w-[30px] h-[30px] ml-4"},null,-1)),Q(g("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>T.value=e),type:"text",placeholder:"必填，请输入联系电话",class:"flex-1 bg-transparent outline-none ml-2 text-[#908E8F] placeholder-[#908E8F]"},null,512),[[W,T.value]])]),s[11]||(s[11]=g("div",{class:"text-[11px] w-[335px] text-[#DA8E54] font-extrabold px-4 mt-[30px]"}," * 说明：以上信息（收货人、详细地址、联系电话）我们将严格保密，仅用于邮寄您获得的实物商品。 ",-1)),g("div",{class:"btn w-[320px] h-[42px] mt-[290px] flex items-center justify-center bg-gradient-to-r from-[#E2AF6C] to-[#F6D2A0] text-[#744C2F] text-[16px] font-bold rounded-lg",onClick:B}," 确认地址 ")])]),w(a,{show:o.value,"custom-style":{background:"rgba(0, 0, 0, 0.5)"},onClick:s[5]||(s[5]=e=>o.value=!1)},{default:De(()=>[g("div",st,[w(u,{columns:n.value,onChange:F,onCancel:s[4]||(s[4]=e=>o.value=!1),onConfirm:S},null,8,["columns"])])]),_:1},8,["show"])],64)}}}),rt=Ne(it,[["__scopeId","data-v-c8421b57"]]);export{rt as default};
